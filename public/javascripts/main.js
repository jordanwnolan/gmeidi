// Generated by CoffeeScript 1.8.0
(function() {
  var TEMPLATES, applicationRequested, bindClickHandlers, bindHandlers, bindScrollHandlers, finalYearQuoteSuccess, nextPhaseHandlers, nextQuestionHandlers, questionSubmitHandler, quoteSuccessHandler, requestApplicationHandler, showPlanHandler;

  $(document).ready(function() {
    return bindHandlers();
  });

  bindHandlers = function() {
    var handlers;
    handlers = [bindClickHandlers, bindScrollHandlers];
    return handlers.map(function(func) {
      return func();
    });
  };

  bindScrollHandlers = function() {};

  bindClickHandlers = function() {
    nextPhaseHandlers();
    nextQuestionHandlers();
    questionSubmitHandler();
    showPlanHandler();
    return requestApplicationHandler();
  };

  nextPhaseHandlers = function() {
    return $(".change_phase").on("click", function(event) {
      var next_phase;
      next_phase = $(event.currentTarget).data("next-phase");
      $("." + next_phase).addClass("active");
      $(".quote").css("visibility", "");
      $("#" + $("#" + next_phase).data("next-phase")).css({
        "visibility": "hidden"
      }).addClass("active");
      return $("body").animate({
        scrollTop: $("#" + next_phase).offset().top
      });
    });
  };

  nextQuestionHandlers = function() {
    $(".question select").on("change", function(event) {
      var next_question, question;
      next_question = $(event.currentTarget).data("next-question");
      question = $("#" + next_question);
      question.addClass("active");
      question.removeAttr("disabled");
      question.attr("enabled", "enabled");
      return question.parent(".question").addClass("active");
    });
    return $("#email").on("input", function(event) {
      var submit;
      submit = $("#question_submit");
      submit.removeAttr("disabled");
      submit.removeClass("disabled");
      submit.attr("enabled", "enabled");
      return submit.parent(".question.submit").addClass("active");
    });
  };

  questionSubmitHandler = function() {
    return $("#questions_form").submit(function(event) {
      var form;
      event.preventDefault();
      form = $(event.currentTarget);
      return $.ajax({
        url: form.attr("action"),
        method: "POST",
        data: form.serialize(),
        success: quoteSuccessHandler,
        error: function(err) {
          return console.log("Oops");
        }
      });
    });
  };

  quoteSuccessHandler = function(data) {
    data = JSON.parse(data);
    data['amounts'] = data['amounts'].map(function(num) {
      return Number(num).toFixed(2);
    });
    if (data['amounts'].length === 1) {
      return finalYearQuoteSuccess(data);
    } else {
      $(".plan_buttons").html(TEMPLATES['button']({
        n: 5,
        'plan-level': 5000
      }));
      $(".plan_buttons").append(TEMPLATES['button']({
        n: 3,
        'plan-level': 3500
      }));
      $("#5k_selection_cost").html("$" + data['amounts'][1]);
      $("#5k_selection").attr("data-plan-price", data['amounts'][1]);
      $("#3k_selection_cost").html("$" + data['amounts'][0]);
      return $("#3k_selection").attr("data-plan-price", data['amounts'][0]);
    }
  };

  finalYearQuoteSuccess = function(data) {
    var el;
    $(".plan_buttons").html(TEMPLATES['button']({
      n: 2,
      'plan-level': 2000
    }));
    el = $("#2k_selection");
    $("#2k_selection_cost").html("$" + data['amounts'][0]);
    return el.css({
      float: "none"
    }).attr("data-plan-price", data['amounts'][0]);
  };

  showPlanHandler = function() {
    return $(".plan_buttons").delegate(".plan_button").on("click", function(event) {
      var target;
      target = $(event.target).closest("button");
      event.preventDefault();
      $("#plan_highlights").addClass("active");
      $("body").animate({
        scrollTop: $("#review_highlights").offset().top - 50
      });
      $("#plan_price i").html(target.data("plan-level"));
      if (target.data("plan-level") === 2000) {
        $("#future_increases").attr("src", "images/red_X.svg");
      } else {
        $("#future_increases").attr("src", "images/check-mark.svg");
      }
      $("#only_x_per_month i").html("$" + target.data("plan-price"));
      $("#request_application").attr("data-plan-selected", target.data("plan-level"));
      return $("#request_application").attr("data-plan-price", target.data("plan-price"));
    });
  };

  requestApplicationHandler = function() {
    return $("#request_application").on("click", function(event) {
      var application, data, target;
      if (!$("#request_application").hasClass("disabled")) {
        $(".application-progress .request_application").addClass("active");
        target = $(event.currentTarget);
        application = $("#questions_form");
        application.append("<input type='hidden' name='application[plan_selected]' value='" + (target.data("plan-selected")) + "'>");
        application.append("<input type='hidden' name='application[plan_price]' value='" + (target.data("plan-price")) + "'>");
        data = $("#questions_form").serialize();
        console.log(data);
        return $.ajax({
          url: "/request_application",
          method: "POST",
          data: data,
          success: applicationRequested,
          error: function(err) {
            return console.log(err);
          }
        });
      }
    });
  };

  applicationRequested = function() {
    $("#request_application").attr("disabled", "disabled");
    return $("#request_application").addClass("disabled");
  };

  TEMPLATES = {
    button: function(opts) {
      return "<button class=\"big_button plan_button change_phase\" data-next-phase=\"plan_highlights\" data-plan-level=\"" + opts['plan-level'] + "\" id=\"" + opts['n'] + "k_selection\" data-plan-price=\"" + opts['plan-price'] + "\"> <div class=\"plan_selection_cost\"> <h1>$" + opts['plan-level'] + "<i>/month</i></h1> <h1><i>to age</i> 67</h1> <h1 id=\"" + opts['n'] + "k_selection_cost\"></h1> </div> </button>";
    }
  };

}).call(this);

//# sourceMappingURL=main.js.map
